{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dashboard | LevelUP</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="{% static 'dashboard.css' %}">
</head>

<body>
  <div class="home-container1">
    <div class="home-container2">

      <!-- Logout -->
      <form method="post" action="{% url 'logout' %}" style="text-align:right;">
        {% csrf_token %}
        <button type="submit">Logout</button>
      </form>

      <h1>You will Level-Up here!</h1>

      <!-- MODE TOGGLE -->
      <div style="display:flex;align-items:center;gap:10px;margin:15px 0;">
        <span>Daily</span>

        <label class="switch">
          <input
            type="checkbox"
            {% if mode == 'weekly' %}checked{% endif %}
            onchange="window.location.href='?mode=' + (this.checked ? 'weekly' : 'daily')"
          >
          <span class="slider round"></span>
        </label>

        <span>Weekly</span>
      </div>

      <!-- ================= DAILY MODE ================= -->
      {% if mode == 'daily' %}
        <p>
          <strong>Progress:</strong>
          {{ completed_tasks }} / {{ total_tasks }} ({{ progress_percent }}%)
        </p>

        <form method="post" style="margin-bottom:20px;">
          {% csrf_token %}
          <input type="text" name="title" placeholder="Enter a task" required>
          <button type="submit">Create task</button>
        </form>

        <h3>Daily Tasks</h3>

        {% for task in tasks %}
          <form method="post" style="display:flex;align-items:center;gap:10px;">
            {% csrf_token %}
            <input type="hidden" name="task_id" value="{{ task.id }}">

            <input
              type="checkbox"
              onchange="this.form.submit()"
              {% if task.is_completed %}checked{% endif %}
            >

            <span {% if task.is_completed %}style="text-decoration:line-through;opacity:0.6;"{% endif %}>
              {{ task.title }}
            </span>

            <button type="submit" name="delete" value="1" style="margin-left:auto;">
              ‚ùå
            </button>
          </form>
        {% empty %}
          <p>No daily tasks yet.</p>
        {% endfor %}
      {% endif %}

      <!-- ================= WEEKLY MODE ================= -->
      {% if mode == 'weekly' %}
        <h3>Weekly Planner</h3>

        <!-- WEEKLY TASK CREATION -->
        <form method="post" style="margin-bottom:20px; display:flex; gap:10px;">
          {% csrf_token %}

          <input
            type="text"
            name="title"
            placeholder="Task name (e.g. Workout)"
            required
          >

          <!-- 24-hour custom time -->
          <input
            type="time"
            name="time_slot"
            required
          >

          <button type="submit">Add weekly task</button>
        </form>

        <!-- EXCEL-STYLE GRID -->
        <table border="1" cellpadding="8" style="border-collapse:collapse;">
          <tr>
            <th>Time</th>
            <th>Task</th>
            <th>Mon</th>
            <th>Tue</th>
            <th>Wed</th>
            <th>Thu</th>
            <th>Fri</th>
            <th>Sat</th>
            <th>Sun</th>
          </tr>

          {% for task in weekly_tasks %}
          <tr>
            <td><strong>{{ task.time_slot }}</strong></td>
            <td>{{ task.title }}</td>

            {% for day in "MTWTFSS" %}
              <td style="text-align:center;">
                <input type="checkbox">
              </td>
            {% endfor %}
          </tr>
          {% empty %}
          <tr>
            <td colspan="9">No weekly tasks yet</td>
          </tr>
          {% endfor %}
        </table>
      {% endif %}

    </div>
  </div>
</body>
</html>
